From c47c47a4afb3aea920a8006cd44ced5874664288 Mon Sep 17 00:00:00 2001
From: Colin Watson <cjwatson@canonical.com>
Date: Tue, 9 Apr 2013 00:02:27 +0100
Subject: [PATCH] Handle sign bit when generating veneer for ARM Thumb branch
 relocation

---
 rts/Linker.c | 1 +
 1 file changed, 1 insertion(+)

Index: ghc-7.6.3/rts/Linker.c
===================================================================
--- ghc-7.6.3.orig/rts/Linker.c	2013-06-05 20:47:32.498881090 +0200
+++ ghc-7.6.3/rts/Linker.c	2013-06-05 20:47:32.498881090 +0200
@@ -4850,6 +4850,7 @@
                // Generate veneer
                SymbolExtra *extra = makeArmSymbolExtra(oc, ELF_R_SYM(info), S+imm+4, 1, is_target_thm);
                offset = (StgWord32) &extra->jumpIsland - P - 4;
+               sign = offset >> 31;
                to_thm = 1;
             } else if (!is_target_thm && ELF_R_TYPE(info) == R_ARM_THM_CALL) {
                offset &= ~0x3;
